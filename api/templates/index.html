<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Solar</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2ecc71; --secondary: #27ae60; --dark: #2c3e50; }
        body { font-family: 'Roboto', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        
        /* Layout chia cột */
        .container { 
            display: grid; 
            grid-template-columns: {{ '1fr 1fr' if role == 'admin' else '1fr' }}; 
            gap: 20px; 
            max-width: {{ '1000px' if role == 'admin' else '500px' }}; 
            margin: 0 auto; 
        }

        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h2 { color: var(--secondary); margin-top: 0; text-align: center;}
        
        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; max-width: 1000px; margin: 0 auto 20px; }
        .logout-btn { background: #e74c3c; color: white; text-decoration: none; padding: 8px 15px; border-radius: 5px; font-size: 14px; }

        /* Form styling */
        label { display: block; margin: 10px 0 5px; font-weight: 500; font-size: 14px;}
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        
        .btn-calc { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; font-weight: bold;}
        .btn-update { width: 100%; padding: 10px; background: var(--dark); color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px;}
        
        .grid-6 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .result-box { margin-top: 20px; background: #e8f8f5; padding: 15px; text-align: center; border-radius: 8px; border: 1px solid #d1f2eb;}
        .alert { padding: 10px; background: #d4edda; color: #155724; border-radius: 5px; margin-bottom: 15px; text-align: center;}
    </style>
</head>
<body>

    <div class="header">
        <div>Xin chào, <strong>{{ role.upper() }}</strong></div>
        <a href="/logout" class="logout-btn">Đăng xuất</a>
    </div>

    <div class="container">
        
        {% if role == 'admin' %}
        <div class="card">
            <h2>⚙️ Cấu Hình Giá Điện</h2>
            {% if msg_update %}
                <div class="alert">{{ msg_update }}</div>
            {% endif %}
            <form method="POST">
                <label>Giá điện sản xuất (VNĐ/kWh):</label>
                <input type="number" name="gia_sx" value="{{ settings.gia_san_xuat }}">

                <label>Giá điện kinh doanh (VNĐ/kWh):</label>
                <input type="number" name="gia_kd" value="{{ settings.gia_kinh_doanh }}">

                <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
                <label><strong>Bậc thang sinh hoạt (6 bậc):</strong></label>
                <div class="grid-6">
                    <div><small>Bậc 1</small><input type="number" name="b1" value="{{ settings.evn_bac[0] }}"></div>
                    <div><small>Bậc 2</small><input type="number" name="b2" value="{{ settings.evn_bac[1] }}"></div>
                    <div><small>Bậc 3</small><input type="number" name="b3" value="{{ settings.evn_bac[2] }}"></div>
                    <div><small>Bậc 4</small><input type="number" name="b4" value="{{ settings.evn_bac[3] }}"></div>
                    <div><small>Bậc 5</small><input type="number" name="b5" value="{{ settings.evn_bac[4] }}"></div>
                    <div><small>Bậc 6</small><input type="number" name="b6" value="{{ settings.evn_bac[5] }}"></div>
                </div>

                <button type="submit" name="btn_update_price" class="btn-update">Lưu Cấu Hình</button>
            </form>
        </div>
        {% endif %}

        <div class="card">
            <h2>⚡ Tính Toán Solar</h2>
            <form method="POST">
                <label>Loại hình:</label>
                <select name="loai_hinh">
                    <option value="can_ho" {% if du_lieu_nhap.loai_hinh == 'can_ho' %}selected{% endif %}>Căn hộ (Theo giá bậc thang bên trái)</option>
                    <option value="kinh_doanh" {% if du_lieu_nhap.loai_hinh == 'kinh_doanh' %}selected{% endif %}>Kinh doanh</option>
                    <option value="san_xuat" {% if du_lieu_nhap.loai_hinh == 'san_xuat' %}selected{% endif %}>Sản xuất</option>
                </select>

                <label>Tiền điện tháng (VNĐ):</label>
                <input type="number" name="tien_dien" placeholder="Nhập tổng tiền..." value="{{ du_lieu_nhap.tien_dien }}" required>

                <button type="submit" name="btn_calc" class="btn-calc">Tính Toán</button>
            </form>

            {% if ket_qua is not none %}
            <div class="result-box">
                <div>Công suất cần lắp:</div>
                <h1 style="color: var(--secondary); margin: 10px 0;">{{ ket_qua }} kWp</h1>
            </div>
            {% endif %}
        </div>

    </div>
</body>
</html>